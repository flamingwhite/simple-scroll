{"version":3,"sources":["webpack:///webpack/bootstrap ca14be5f72b15a0e0baf","webpack:///external \"react\"","webpack:///external \"timers\"","webpack:///./src/index.js","webpack:///external \"react-dom\"","webpack:///external \"ramda\"","webpack:///./src/Scroller.js","webpack:///external \"rxjs/Rx\"","webpack:///external \"jquery\""],"names":["R","perPage","visible","App","state","items","range","loadMore","Promise","setState","resolve","hasMore","length","height","width","border","overflow","slice","map","padding","margin","Math","random","it","Component","process","browser","render","document","getElementById","Scroller","willUnmount$","Subject","initialLoad","props","initSubject","initProcessing","checkOnce","btmElm","position","top","elm","then","console","log","shouldLoadMore","distanceToBottom","percentToBottom","toBottom","next","complete","scrollDown$","Observable","fromEvent","scrollTop","pairwise","filter","x","mousewheel$","e","originalEvent","deltaY","debounceTime","processing","merge","takeUntil","a","subscribe","children","display","flexDirection","flex"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ca14be5f72b15a0e0baf","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"timers\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"timers\"\n// module id = 1\n// module chunks = 0","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport * as R from 'ramda';\nimport Scroller from './Scroller';\nimport { setTimeout } from 'timers';\n\nconst perPage = 3;\nconst visible = 3;\n\nclass App extends React.Component {\n  state = {\n    items: R.range(1, 120),\n    visible\n  };\n  //   loadMore = () => {\n  //     this.setState({ visible: this.state.visible + 10 });\n  //   };\n\n  loadMore = () =>\n    new Promise(resolve => {\n      setTimeout(() => {\n        this.setState({ visible: this.state.visible + perPage });\n        resolve('im happy');\n      }, 2000);\n    });\n\n  render() {\n    const { items, visible } = this.state;\n    const { loadMore } = this;\n    const hasMore = visible < items.length;\n    return (\n      <div>\n        <div>{visible}</div>\n        <div\n          style={{\n            height: 400,\n            width: 500,\n            border: '1px solid black',\n            overflow: 'auto'\n          }}\n        >\n          <Scroller loadMore={loadMore} hasMore={hasMore}>\n            {items.slice(0, visible).map(it => (\n              <div\n                style={{\n                  padding: 4,\n                  border: '1px solid red',\n                  margin: 4,\n                  height: Math.random() * 50\n                }}\n                key={it}\n              >\n                {it}\n              </div>\n            ))}\n          </Scroller>\n        </div>\n      </div>\n    );\n  }\n}\n\nif (process.browser)\n  ReactDOM.render(<App />, document.getElementById('content'));\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"react-dom\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-dom\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"ramda\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ramda\"\n// module id = 5\n// module chunks = 0","import React, { Component } from 'react';\nimport Rx from 'rxjs/Rx';\nimport $ from 'jquery';\nimport { setTimeout } from 'timers';\n\nclass Scroller extends Component {\n  willUnmount$ = new Rx.Subject();\n  initialLoad = () => {\n    const { willUnmount$ } = this;\n    const { loadMore } = this.props;\n    const initSubject = new Rx.Subject();\n\n    let initProcessing = false;\n    const checkOnce = () => {\n      if (initProcessing) return;\n      if (\n        $(this.btmElm).position().top <= $(this.elm).height() &&\n        this.props.hasMore\n      ) {\n        // initSubject.next(1);\n        initProcessing = true;\n        Promise.resolve(loadMore()).then(() => {\n          console.log(this.btmElm.position().top, 'position top');\n          console.log(this.elm.height(), 'height');\n          console.log('inner sub');\n          initProcessing = false;\n          checkOnce();\n        });\n      }\n    };\n\n    // initSubject\n    //   .flatMap(() => Promise.resolve(loadMore()))\n    //   .delay(200)\n    //   .takeWhile(() => this.shouldLoadMore())\n    //   .takeUntil(willUnmount$)\n    //   .subscribe(() => {\n    //     console.log(this.btmElm.position().top, 'position top');\n    //     console.log(this.elm.height(), 'height');\n    //     console.log('inner sub');\n    //     initSubject.next(1);\n    //   });\n\n    // if (\n    //   $(this.btmElm).position().top <= $(this.elm).height() &&\n    //   this.props.hasMore\n    // ) {\n    //   initSubject.next(1);\n    // }\n  };\n\n  shouldLoadMore = () => {\n    const { distanceToBottom = 0, percentToBottom } = this.props;\n\n    const top = this.btmElm.position().top;\n    const height = this.elm.height();\n    const toBottom = height - top;\n\n    if (percentToBottom != null) {\n      return percentToBottom * height > toBottom;\n    }\n    return toBottom <= distanceToBottom;\n  };\n\n  componentWillUnmount() {\n    console.log('component unmount');\n    this.willUnmount$.next('unmount');\n    this.willUnmount$.complete();\n  }\n\n  componentDidMount() {\n    const { willUnmount$ } = this;\n    const { loadMore } = this.props;\n\n    console.log(this.btmElm.position().top, 'position top');\n    console.log(this.elm.height(), 'height');\n    this.initialLoad();\n\n    //   Rx.Observable.of($(this.btmElm).position().top <= $(this.elm).height())\n    // .filter(v => v)\n    const scrollDown$ = Rx.Observable.fromEvent(this.elm, 'scroll')\n      .map(() => $(this.elm).scrollTop())\n      .pairwise()\n      .filter(x => x[1] > x[0])\n      .map(x => x[1]);\n\n    const mousewheel$ = Rx.Observable.fromEvent(this.elm, 'mousewheel')\n      .filter(\n        e =>\n          e.originalEvent.deltaY >= 0 &&\n          this.btmElm.position().top <= this.elm.height()\n      )\n      .debounceTime(50);\n\n    // Rx.Observable.fromEvent(this.elm, 'mousewheel').subscribe(console.log);\n\n    let processing = false;\n    mousewheel$\n      .merge(scrollDown$)\n      .filter(() => this.btmElm.position().top <= this.elm.height())\n      //   .filter(() => this.shouldLoadMore())\n      .filter(() => this.props.hasMore)\n      .takeUntil(willUnmount$)\n      .map(a => {\n        console.log('aaa');\n        return a;\n      })\n      .subscribe(a => {\n        if (processing) return;\n        processing = true;\n        Promise.resolve(loadMore()).then(() => {\n          processing = false;\n          console.log('bbb---');\n        });\n      });\n\n    // mousewheel$\n    //   .merge(scrollDown$)\n    //   .filter(() => this.props.hasMore)\n    //   .takeUntil(willUnmount$)\n    //   .map(a => {\n    //     console.log('aaa');\n    //     return a;\n    //   })\n    //   .exhaustMap(() => Rx.Observable.fromPromise(loadMore()))\n    //   .map(a => {\n    //     console.log('bbb');\n    //     return a;\n    //   })\n    //   .subscribe(a => {\n    //     console.log(this.btmElm.position().top, this.elm.height());\n    //     // loadMore();\n    //     console.log('time to reload          ----------', a);\n    //   });\n  }\n\n  render() {\n    const { children } = this.props;\n\n    return (\n      <div\n        ref={elm => (this.elm = $(elm))}\n        className=\"sky vbox\"\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          position: 'relative',\n          height: '100%',\n          flex: 1,\n          overflow: 'auto'\n        }}\n      >\n        <div>{children}</div>\n        <div\n          ref={btmElm => (this.btmElm = $(btmElm))}\n          style={{ border: '2px solid green' }}\n        />\n      </div>\n    );\n  }\n}\n\nexport default Scroller;\n\n\n\n// WEBPACK FOOTER //\n// ./src/Scroller.js","module.exports = require(\"rxjs/Rx\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"rxjs/Rx\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"jquery\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jquery\"\n// module id = 8\n// module chunks = 0"],"sourceRoot":""}